<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Считывание NFC-метки</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding-top: 50px; }
    .container { width: 50%; margin: 0 auto; padding-top: 20px; }
    .result { margin-top: 20px; }
    .valid { color: green; font-size: 24px; }
    .error { color: red; }
    p { font-size: 18px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Считывание NFC-метки</h1>
    <button id="readNfcButton">Считать NFC-метку</button>
    
    <div class="result" id="result">
      <p id="fio"></p>
      <p id="school"></p>
      <p id="city"></p>
      <p id="class"></p>
      <span id="status"></span>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/build/cipher-core.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/build/aes.js"></script>
  <script>
    const secretKey = "your-secret-key"; // секретный ключ для шифрования

    // Тестовые данные для шифрования
    const testData = {
      fio: "Иванов Иван Иванович",
      school: "Школа №25",
      city: "Воронеж",
      class: "10А"
    };

    // Функция для шифрования данных
    function encryptData(data) {
      return CryptoJS.AES.encrypt(JSON.stringify(data), secretKey).toString();
    }

    // Функция для дешифрования данных
    function decryptData(encryptedData) {
      const bytes = CryptoJS.AES.decrypt(encryptedData, secretKey);
      return JSON.parse(bytes.toString(CryptoJS.enc.Utf8));
    }

    // Функция для отображения данных
    function displayData(data) {
      document.getElementById('fio').textContent = "ФИО: " + data.fio;
      document.getElementById('school').textContent = "Школа: " + data.school;
      document.getElementById('city').textContent = "Город: " + data.city;
      document.getElementById('class').textContent = "Класс: " + data.class;
      document.getElementById('status').textContent = "✔️ Данные успешно считаны";
      document.getElementById('status').classList.add('valid');
    }

    // Пример: шифруем данные и выводим на экран
    const encryptedData = encryptData(testData);

    // Дешифруем данные (например, когда NFC-метка считывается)
    const decryptedData = decryptData(encryptedData);
    console.log(decryptedData);

    // Обработчик кнопки считывания NFC
    document.getElementById('readNfcButton').addEventListener('click', async () => {
      try {
        if ("NFC" in window) {
          const reader = new NFCReader();
          const nfcData = await reader.read(); // имитируем чтение NFC-данных
          const decryptedNfcData = decryptData(nfcData);
          displayData(decryptedNfcData);
        } else {
          alert("Ваш браузер не поддерживает NFC.");
        }
      } catch (error) {
        document.getElementById('status').textContent = "❌ Ошибка при считывании NFC.";
        document.getElementById('status').classList.add('error');
      }
    });

    // Имитация считывания NFC данных
    class NFCReader {
      async read() {
        try {
          // Симуляция данных, полученных с NFC
          const nfcData = encryptedData; // Предположим, что NFC-метка возвращает зашифрованные данные
          console.log("NFC Data: ", nfcData);
          return nfcData; // возвращаем зашифрованные данные
        } catch (error) {
          console.error("Ошибка при считывании NFC", error);
          throw new Error("Не удалось считать NFC-метку.");
        }
      }
    }
  </script>
</body>
</html>
